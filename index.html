<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Đăng ký nguyện vọng – Mockup</title>
  <style>
    :root{
      --bg:#f6f8fa;--card:#ffffff;--primary:#2f74da;--text:#1f2328;--muted:#6a737d;--ok:#1a7f37;--warn:#b54708;--danger:#d1242f;--line:#e5e7eb;
      --sidebar:#0d253f;--sidebar-text:#d9e3f0;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial; background:var(--bg); color:var(--text)}
    .app{display:grid; grid-template-columns:260px 1fr; min-height:100vh}
    /* Sidebar */
    .sidebar{background:var(--sidebar); color:var(--sidebar-text); padding:18px 14px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.2px; margin-bottom:16px}
    .brand .badge{background:#0ea5e9; color:white; padding:4px 8px; border-radius:999px; font-size:12px}
    .nav h4{opacity:.7; font-weight:600; font-size:12px; margin:18px 8px 8px}
    .nav a{display:flex; align-items:center; gap:10px; color:inherit; text-decoration:none; padding:10px 12px; border-radius:10px; margin:4px 0; font-size:14px}
    .nav a:hover{background:rgba(255,255,255,.06)}
    .nav a.active{background:rgba(255,255,255,.12)}
    /* Main */
    .main{padding:22px 26px}
    .header{display:flex; align-items:center; justify-content:space-between; margin-bottom:14px}
    .title{font-size:20px; font-weight:700}
    .breadcrumb{font-size:12px; color:var(--muted)}
    .card{background:var(--card); border:1px solid var(--line); border-radius:14px; box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .p-16{padding:16px}
    /* Steps */
    .steps{display:grid; grid-template-columns:repeat(4,1fr); gap:14px; margin-bottom:14px}
    .step{display:flex; align-items:center; gap:8px; background:var(--card); border:1px solid var(--line); padding:10px 12px; border-radius:12px}
    .step .dot{width:22px; height:22px; display:grid; place-items:center; border-radius:50%; background:#e5f0ff; color:#1d4ed8; font-size:12px; font-weight:700}
    .step.done .dot{background:#dcfce7; color:#166534}
    .step .label{font-size:13px}
    /* Toolbar */
    .toolbar{display:flex; flex-wrap:wrap; gap:10px; margin:10px 0 18px}
    .btn{border:1px solid var(--line); background:#fff; padding:10px 12px; border-radius:10px; font-weight:600; font-size:14px; cursor:pointer}
    .btn.primary{background:var(--primary); border-color:var(--primary); color:#fff}
    .btn.ghost{background:transparent; color:var(--primary); border-color:var(--primary)}
    .btn:active{transform:translateY(1px)}
    /* List */
    .list{display:flex; flex-direction:column; gap:12px}
    .item{display:grid; grid-template-columns:72px 1fr 38px; gap:12px; border:1px solid var(--line); border-radius:14px; padding:12px; background:#fff; align-items:stretch}
    .priority{display:grid; place-items:center; background:#f1f5f9; border:1px dashed #cbd5e1; border-radius:10px; font-weight:800; font-size:18px}
    .fields{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px 16px}
    .kv{font-size:13px}
    .kv b{display:inline-block; min-width:160px; color:#374151}
    .status.ok{color:var(--ok); font-weight:700}
    .status.warn{color:var(--warn); font-weight:700}
    .actions{display:flex; align-items:start; gap:8px}
    .iconbtn{width:34px; height:34px; display:grid; place-items:center; border:1px solid var(--line); border-radius:10px; background:#fff; cursor:pointer}
    .iconbtn:hover{background:#f8fafc}
    .dragger{cursor:grab}
    .empty{padding:28px; text-align:center; color:var(--muted)}
    /* Modal */
    .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.35); padding:20px}
    .modal.active{display:grid}
    .dialog{width:min(880px,100%); background:#fff; border-radius:16px; border:1px solid var(--line); overflow:hidden}
    .dialog header{display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border-bottom:1px solid var(--line)}
    .dialog h3{margin:0; font-size:18px}
    .dialog .body{padding:16px}
    .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
    .field{display:flex; flex-direction:column; gap:6px}
    label{font-size:13px; color:#374151}
    input,select,textarea{border:1px solid var(--line); border-radius:10px; padding:10px 12px; font-size:14px}
    textarea{min-height:72px}
    .dialog footer{display:flex; justify-content:flex-end; gap:10px; padding:12px 16px; border-top:1px solid var(--line); background:#fafafa}
    /* Print */
    @media print{
      .sidebar,.toolbar,.steps,.header .breadcrumb,.actions,.btn{display:none !important}
      .app{grid-template-columns:1fr}
      .main{padding:0}
      .item{page-break-inside:avoid}
    }
  </style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l7 4v6c0 5-3 7-7 10C8 19 5 17 5 12V6l7-4z"/></svg>
      <div>Bộ GD&ĐT · Kỳ thi TN THPT</div>
      <span class="badge">Mock</span>
    </div>
    <nav class="nav">
      <h4>Danh mục</h4>
      <a class="active" href="#">Trang chủ</a>
      <a href="#">Phiếu đăng ký</a>
      <a href="#">Tra cứu</a>
      <a href="#">Xét tuyển</a>
      <a href="#">Công cụ ôn luyện</a>
      <a href="#">Đổi mật khẩu</a>
    </nav>
  </aside>
  <main class="main">
    <div class="header">
      <div>
        <div class="breadcrumb">Hệ thống/ Xét tuyển/ Đăng ký nguyện vọng</div>
        <div class="title">Thông tin đăng ký nguyện vọng của thí sinh</div>
      </div>
      <button class="btn ghost" onclick="downloadGuide()">Tải hướng dẫn đăng ký</button>
    </div>

    <div class="steps">
      <div class="step done"><div class="dot">1</div><div class="label">Danh sách nguồn dữ liệu đủ điều kiện trúng tuyển</div></div>
      <div class="step done"><div class="dot">2</div><div class="label">Thêm nguyện vọng</div></div>
      <div class="step"><div class="dot">3</div><div class="label">Nhập OTP</div></div>
      <div class="step"><div class="dot">4</div><div class="label">Xem danh sách NV đã đăng ký</div></div>
    </div>

    <div class="card p-16">
      <div class="toolbar">
        <button class="btn primary" id="btnAdd">Thêm nguyện vọng</button>
        <button class="btn" id="btnSort">Xếp theo thứ tự NV</button>
        <button class="btn" id="btnPrint">In danh sách</button>
        <button class="btn" id="btnHistory">Lịch sử giao dịch</button>
        <span style="margin-left:auto; color:var(--muted); font-size:13px">Dữ liệu lưu tự động vào LocalStorage</span>
      </div>

      <div id="list" class="list"></div>
      <div id="empty" class="empty" hidden>Chưa có nguyện vọng nào. Bấm <b>Thêm nguyện vọng</b> để bắt đầu.</div>
    </div>
  </main>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="dialog">
    <header>
      <h3 id="modalTitle">Thêm nguyện vọng</h3>
      <button class="iconbtn" onclick="closeModal()" title="Đóng">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </header>
    <div class="body">
      <div class="grid">
        <div class="field"><label>Thứ tự NV</label><input id="fPriority" type="number" min="1" placeholder="VD: 1"/></div>
        <div class="field"><label>Trường</label><input id="fTruong" placeholder="VD: Học viện Kỹ thuật Mật mã (Hà Nội)"/></div>
        <div class="field"><label>Ngành</label><input id="fNganh" placeholder="VD: An toàn thông tin"/></div>
        <div class="field"><label>Hệ đào tạo</label>
          <select id="fHe">
            <option>Đại học</option>
            <option>Cao đẳng</option>
            <option>Liên thông</option>
          </select>
        </div>
        <div class="field"><label>Chương trình đào tạo</label>
          <select id="fCT">
            <option>Chương trình đại trà</option>
            <option>Chất lượng cao</option>
            <option>Tiên tiến</option>
          </select>
        </div>
        <div class="field"><label>Mô tả</label><input id="fMoTa" placeholder="Tổ hợp xét tuyển, campus..."/></div>
        <div class="field"><label>Trạng thái</label>
          <select id="fTrangThai">
            <option>Đã ghi nhận NV</option>
            <option>Chưa xác nhận</option>
          </select>
        </div>
        <div class="field"><label>Ghi chú</label><input id="fGhiChu" placeholder="Ưu tiên, học bổng..."/></div>
        <div class="field" style="grid-column:1/3"><label>Cảnh báo</label><textarea id="fCanhBao" placeholder="VD: Điểm chuẩn cao, cân nhắc NV1"></textarea></div>
      </div>
    </div>
    <footer>
      <button class="btn" onclick="closeModal()">Huỷ</button>
      <button class="btn primary" id="btnSave">Lưu</button>
    </footer>
  </div>
</div>

<!-- History Modal -->
<div class="modal" id="modalHistory">
  <div class="dialog">
    <header>
      <h3>Lịch sử giao dịch</h3>
      <button class="iconbtn" onclick="document.getElementById('modalHistory').classList.remove('active')" title="Đóng">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </header>
    <div class="body">
      <div id="history" style="font-size:13px; line-height:1.5"></div>
    </div>
    <footer>
      <button class="btn" onclick="clearHistory()">Xoá lịch sử</button>
      <button class="btn primary" onclick="document.getElementById('modalHistory').classList.remove('active')">Đóng</button>
    </footer>
  </div>
</div>

<script>
  const KEY = 'nv_list_v1';
  const HKEY = 'nv_history_v1';
  const $ = (sel)=>document.querySelector(sel);
  const listEl = $('#list');
  const emptyEl = $('#empty');

  function now(){return new Date().toLocaleString('vi-VN');}
  function logHistory(msg){
    const logs = JSON.parse(localStorage.getItem(HKEY)||'[]');
    logs.unshift(`[${now()}] ${msg}`);
    localStorage.setItem(HKEY, JSON.stringify(logs));
  }
  function openHistory(){
    const logs = JSON.parse(localStorage.getItem(HKEY)||'[]');
    const box = document.getElementById('history');
    box.innerHTML = logs.length? `<ul>${logs.map(l=>`<li>${l}</li>`).join('')}</ul>` : 'Chưa có giao dịch.';
    document.getElementById('modalHistory').classList.add('active');
  }
  function clearHistory(){localStorage.removeItem(HKEY); openHistory()}

  function save(items){ localStorage.setItem(KEY, JSON.stringify(items)); }
  function load(){ return JSON.parse(localStorage.getItem(KEY)||'[]'); }

  function seed(){
    const data = [
      {id:crypto.randomUUID(), priority:1, truong:'Học viện Kỹ thuật Mật mã (CS Hà Nội)', nganh:'Thiết kế công nghiệp', he:'Đại học', ct:'Chương trình đại trà', mota:'A00/A01', trangthai:'Đã ghi nhận NV', ghichu:'', canhbao:''},
      {id:crypto.randomUUID(), priority:2, truong:'Trường Đại học …', nganh:'Marketing', he:'Đại học', ct:'Chương trình đại trà', mota:'D01', trangthai:'Đã ghi nhận NV', ghichu:'', canhbao:''},
      {id:crypto.randomUUID(), priority:3, truong:'Trường Đại học …', nganh:'Kỹ thuật hoá học', he:'Đại học', ct:'Chương trình đại trà', mota:'A00', trangthai:'Đã ghi nhận NV', ghichu:'', canhbao:''}
    ];
    save(data);
  }

  function render(){
    const items = load().sort((a,b)=>a.priority-b.priority);
    listEl.innerHTML = '';
    if(!items.length){ emptyEl.hidden = false; return; } else emptyEl.hidden = true;

    for(const it of items){
      const item = document.createElement('div');
      item.className = 'item';
      item.draggable = true; item.dataset.id = it.id;
      item.innerHTML = `
        <div class="priority dragger" title="Kéo để đổi thứ tự">${it.priority}</div>
        <div class="fields">
          <div class="kv"><b>Trường:</b> ${escapeHTML(it.truong)}</div>
          <div class="kv"><b>Ngành:</b> ${escapeHTML(it.nganh)}</div>
          <div class="kv"><b>Hệ đào tạo:</b> ${escapeHTML(it.he)}</div>
          <div class="kv"><b>Chương trình đào tạo:</b> ${escapeHTML(it.ct)}</div>
          <div class="kv"><b>Mô tả:</b> ${escapeHTML(it.mota||'')}</div>
          <div class="kv"><b>Trạng thái:</b> <span class="status ok">${escapeHTML(it.trangthai)}</span></div>
          <div class="kv"><b>Ghi chú:</b> ${escapeHTML(it.ghichu||'')}</div>
          <div class="kv"><b>Cảnh báo:</b> ${escapeHTML(it.canhbao||'')}</div>
        </div>
        <div class="actions">
          <button class="iconbtn" title="Sửa" data-act="edit">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>
          </button>
          <button class="iconbtn" title="Xoá" data-act="del">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/></svg>
          </button>
        </div>`;

      // drag events
      item.addEventListener('dragstart', e=>{ item.classList.add('dragging'); e.dataTransfer.setData('text/plain', it.id); });
      item.addEventListener('dragend', ()=>{ item.classList.remove('dragging'); });
      item.addEventListener('dragover', e=>{ e.preventDefault(); item.style.outline='2px dashed #93c5fd'; });
      item.addEventListener('dragleave', ()=>{ item.style.outline=''; });
      item.addEventListener('drop', e=>{
        e.preventDefault(); item.style.outline='';
        const fromId = e.dataTransfer.getData('text/plain');
        const toId = it.id; if(fromId===toId) return;
        reorder(fromId,toId);
      });

      // action buttons
      item.querySelector('[data-act="edit"]').onclick = ()=> openModal(it);
      item.querySelector('[data-act="del"]').onclick = ()=> delItem(it.id);

      listEl.appendChild(item);
    }
  }

  function reorder(fromId,toId){
    const items = load();
    const fromIdx = items.findIndex(x=>x.id===fromId);
    const toIdx = items.findIndex(x=>x.id===toId);
    if(fromIdx<0||toIdx<0) return;
    const [moved] = items.splice(fromIdx,1);
    items.splice(toIdx,0,moved);
    // re-index priorities
    items.forEach((x,i)=>x.priority=i+1);
    save(items); render(); logHistory(`Kéo thả đổi thứ tự (ID ${fromId} → trước ID ${toId})`);
  }

  function delItem(id){
    if(!confirm('Xoá nguyện vọng này?')) return;
    let items = load();
    const rm = items.find(x=>x.id===id);
    items = items.filter(x=>x.id!==id);
    items.forEach((x,i)=>x.priority=i+1);
    save(items); render(); logHistory(`Xoá nguyện vọng: ${rm?.truong||id}`);
  }

  // Modal form helpers
  let editingId = null;
  function openModal(data){
    editingId = data?.id||null;
    $('#modalTitle').textContent = editingId? 'Sửa nguyện vọng' : 'Thêm nguyện vọng';
    $('#fPriority').value = data?.priority || (load().length+1);
    $('#fTruong').value = data?.truong || '';
    $('#fNganh').value = data?.nganh || '';
    $('#fHe').value = data?.he || 'Đại học';
    $('#fCT').value = data?.ct || 'Chương trình đại trà';
    $('#fMoTa').value = data?.mota || '';
    $('#fTrangThai').value = data?.trangthai || 'Đã ghi nhận NV';
    $('#fGhiChu').value = data?.ghichu || '';
    $('#fCanhBao').value = data?.canhbao || '';
    $('#modal').classList.add('active');
  }
  function closeModal(){ $('#modal').classList.remove('active'); }

  function collect(){
    const priority = Math.max(1, parseInt($('#fPriority').value||'1',10));
    return {
      id: editingId || crypto.randomUUID(),
      priority,
      truong: $('#fTruong').value.trim(),
      nganh: $('#fNganh').value.trim(),
      he: $('#fHe').value,
      ct: $('#fCT').value,
      mota: $('#fMoTa').value.trim(),
      trangthai: $('#fTrangThai').value,
      ghichu: $('#fGhiChu').value.trim(),
      canhbao: $('#fCanhBao').value.trim(),
    };
  }

  function saveForm(){
    const data = collect();
    if(!data.truong || !data.nganh){ alert('Vui lòng điền Trường và Ngành.'); return; }
    let items = load();
    const idx = items.findIndex(x=>x.id===data.id);
    if(idx>=0){ items[idx] = {...items[idx], ...data}; logHistory(`Cập nhật nguyện vọng: ${data.truong}`); }
    else { items.push(data); logHistory(`Thêm nguyện vọng mới: ${data.truong}`); }
    // normalize priorities (unique, sorted)
    items.sort((a,b)=>a.priority-b.priority).forEach((x,i)=>x.priority=i+1);
    save(items); render(); closeModal();
  }

  // Utilities
  function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
  function downloadGuide(){
    const blob = new Blob([`Hướng dẫn ngắn:\n- Bấm Thêm nguyện vọng.\n- Điền các trường bắt buộc.\n- Kéo-thả để sắp xếp.\n- Dữ liệu tự lưu LocalStorage.`],{type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='huong-dan-dang-ky.txt'; a.click(); URL.revokeObjectURL(url);
  }

  // Buttons
  document.getElementById('btnAdd').onclick = ()=>openModal();
  document.getElementById('btnSave').onclick = saveForm;
  document.getElementById('btnPrint').onclick = ()=>window.print();
  document.getElementById('btnSort').onclick = ()=>{
    const items = load().sort((a,b)=>a.priority-b.priority).map((x,i)=>({...x, priority:i+1}));
    save(items); render(); logHistory('Sắp xếp lại theo thứ tự NV');
  };
  document.getElementById('btnHistory').onclick = openHistory;

  // Boot
  if(!load().length) seed();
  render();
</script>
</body>
</html>
